var S=Object.defineProperty;var T=(n,t,e)=>t in n?S(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var s=(n,t,e)=>(T(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();const h=6,u=7;class b{constructor(t,e){s(this,"position");s(this,"prevPosition");s(this,"radius",35);s(this,"sprite");this.sprite=document.createElement("div"),Object.assign(this.sprite.style,{zIndex:"-1",width:`${2*this.radius}px`,height:`${2*this.radius}px`,borderRadius:"50%",position:"absolute",backgroundColor:e}),this.setCenterPosition(t),this.prevPosition={...t}}getPosition(){return this.position}setCenterPosition(t){this.sprite.style.left=`${t.x-this.radius}px`,this.sprite.style.top=`${t.y-this.radius}px`,this.position=t}setCenterX(t){this.sprite.style.left=`${t-this.radius}px`,this.position.x=t}setCenterY(t){this.sprite.style.top=`${t-this.radius}px`,this.position.y=t}getTopLeftPosition(){return{x:this.position.x-this.radius,y:this.position.y-this.radius}}getTopLeftX(){return this.position.x-this.radius}getTopLeftY(){return this.position.y-this.radius}}class y extends b{constructor(e,r){let i="rgb(255, 104, 104)";r=="Y"&&(i="rgb(221, 221, 76)");super(e,i);s(this,"DROP_DURATION",200);this.sprite.classList.toggle("board-token",!0)}drop(e){return new Promise(r=>{let i=100*e+100,o=[{top:this.sprite.style.top,easing:"ease-in"},{top:`${i-this.radius}px`}],a={duration:this.DROP_DURATION};this.sprite.animate(o,a).addEventListener("finish",()=>{this.setCenterY(i),r(1)})})}}class w{constructor(t,e,r){s(this,"canvas");s(this,"token");s(this,"game");s(this,"dropping",!1);this.game=t,this.canvas=t.canvas,this.token=new y({x:100*e+50,y:50},this.game.turn),this.canvas.append(this.token.sprite),this.drop(r)}leaveState(){if(this.dropping)throw new Error("cannot leave state")}resumeState(){}async drop(t){this.dropping=!0,await this.token.drop(t),this.dropping=!1,this.game.reactToWin()}}class L extends b{constructor(t,e){let r="rgba(255, 104, 104, 0.5)";e=="Y"&&(r="rgba(221, 221, 76, 0.5)"),super(t,r)}update(t,e){let r=Math.max(Math.abs(e),10),i=Math.floor(t/100)*100+50;i<0&&(i=50),i>700&&(i=650);let o=i-this.position.x;if(o==0)return;let a=o>0?1:-1;this.setCenterX(this.position.x+a*r);let l=i-this.position.x,c=i-this.prevPosition.x;(l==0||c*l<0)&&this.setCenterX(i),this.prevPosition={...this.position}}}class p{constructor(t){s(this,"game");s(this,"DELAY",10);s(this,"mouseX");s(this,"dmouseX",0);s(this,"prevMouseX");s(this,"token");s(this,"canvas");s(this,"boardImg");s(this,"loopId");s(this,"eventListeners",[{type:"click",listener:()=>this.dropToken(-1)}]);this.game=t,this.canvas=t.canvas,this.boardImg=t.boardImg,this.mouseX=t.getMousePos().x,this.token=new L({x:this.mouseX,y:50},this.game.turn),this.canvas.append(this.token.sprite),this.prevMouseX=this.mouseX,this.addEventListeners(),this.startLoop(),this.game.timerController.startTimer()}loop(t){t.mouseX=t.game.getMousePos().x,t.dmouseX=t.mouseX-t.prevMouseX,t.prevMouseX=t.mouseX,t.token.update(t.mouseX,t.dmouseX)}startLoop(){this.loopId=setInterval(()=>this.loop(this),this.DELAY)}stopLoop(){clearInterval(this.loopId)}addEventListeners(){this.eventListeners.forEach(t=>{this.boardImg.addEventListener(t.type,t.listener)})}removeEventListeners(){this.eventListeners.forEach(t=>{this.boardImg.removeEventListener(t.type,t.listener)})}leaveState(){this.removeEventListeners(),this.stopLoop(),this.token.sprite.remove()}resumeState(){this.canvas.append(this.token.sprite),this.prevMouseX=this.mouseX,this.addEventListeners(),this.startLoop(),this.game.timerController.startTimer()}dropToken(t){let e;t<0?e=Math.floor(this.token.position.x/100):e=t;let r=this.game.calculateDestRow(e);return r==-1?(console.log("invalid"),!1):(this.game.placeToken(e,r),this.game.changeState(new w(this.game,e,r)),!0)}}class g{constructor(t,e){s(this,"sprite",document.querySelector(".timer"));s(this,"playerTurn",this.sprite.querySelector(".player-turn"));s(this,"playerTurnTimer",this.sprite.querySelector(".player-turn-timer"));s(this,"tip",this.sprite.querySelector(".tip"));s(this,"TIMERDURATION");s(this,"MESSAGEDURATION",1e3);s(this,"timeRemaining");s(this,"game");s(this,"loopId",-1);this.TIMERDURATION=e,this.timeRemaining=e,this.game=t,this.playerTurnTimer.innerText=`${this.timeRemaining}s`,e<0&&(this.playerTurnTimer.innerText="--")}startTimer(){this.loopId!=-1&&clearInterval(this.loopId),this.loopId=setInterval(()=>this.decrement(this),1e3)}pauseTimer(){this.loopId!=-1&&clearInterval(this.loopId)}decrement(t){if(!(t.TIMERDURATION<0)&&(t.timeRemaining--,this.playerTurnTimer.innerText=`${t.timeRemaining}s`,t.timeRemaining==0&&t.game.state instanceof p)){let e=document.querySelector(".board-wrapper .board-warn");e.classList.toggle("show",!0),setTimeout(()=>e.classList.toggle("show",!1),this.MESSAGEDURATION);let r=t.game.state.dropToken(-1);for(;!r;){let i=Math.floor(Math.random()*u);r=t.game.state.dropToken(i)}}}setTurn(t){this.changeColorScheme(t),!(this.TIMERDURATION<0)&&(this.timeRemaining=this.TIMERDURATION,this.playerTurnTimer.innerText=`${this.timeRemaining}s`)}changeColorScheme(t){switch(t){case"R":this.sprite.style.backgroundColor="var(--red)",this.tip.style.color="var(--red)",this.sprite.style.color="white",this.playerTurn.innerText="PLAYER 1'S TURN";break;case"Y":this.sprite.style.backgroundColor="var(--yellow)",this.tip.style.color="var(--yellow)",this.sprite.style.color="black",this.playerTurn.innerText="PLAYER 2'S TURN";break}}}class m{constructor(t){s(this,"sprite");s(this,"playButton");s(this,"game");this.game=t,this.sprite=document.createElement("div"),this.sprite.classList.add("board-alert","start-game"),this.sprite.innerHTML='<div class="text-box"><div class="block1">press play button below <br>to start new game</div><div><button class="button-purple">PLAY</button></div></div>',this.sprite.style.display="flex",this.playButton=this.sprite.querySelector(".button-purple"),this.playButton.addEventListener("click",e=>this.startGame(this,e)),this.game.canvas.append(this.sprite)}startGame(t,e){e.stopPropagation(),t.game.startNewRound(),t.sprite.remove()}leaveState(){this.sprite.remove()}resumeState(){this.game.canvas.append(this.sprite)}}class d{constructor(t,e,r){s(this,"sprite");s(this,"TIMERDURATION",5);s(this,"timer",this.TIMERDURATION);s(this,"game");s(this,"button");this.game=t,this.sprite=document.createElement("div"),this.sprite.classList.add("board-alert","game-over"),this.sprite.innerHTML='<div class="winner">RED WON</div><button class="button-purple new-round">NEXT ROUND</button><div class="spacer2"></div>',this.sprite.style.display="flex";let i=this.sprite.querySelector(".winner"),o=!1;switch(e){case"R":this.game.incrementRedScore(),i.innerText="RED WON",i.style.color="red",this.checkOverallWin(this.game.getScore(e))&&(i.innerText="OVERALL WINNER: RED",o=!0);break;case"Y":this.game.incrementYellowScore(),i.innerText="YELLOW WON",i.style.color="rgb(0,0,0)",this.checkOverallWin(this.game.getScore(e))&&(i.innerText="OVERALL WINNER: YELLOW",o=!0);break;case"N":i.innerText="TIE",i.style.color="rgb(133, 5, 238);";break}this.game.canvas.append(this.sprite),this.button=this.sprite.querySelector(".new-round"),o?(this.button.innerText="NEW GAME",this.button.addEventListener("click",a=>{a.stopPropagation(),this.startNewGame(this)})):this.button.addEventListener("click",a=>{a.stopPropagation(),this.startNewRound(this)}),r.pauseTimer()}checkOverallWin(t){return t==Math.floor(this.game.ROUNDSEACHGAME/2)+1}startNewGame(t){t.sprite.remove(),t.game.boardController.startNewGame()}startNewRound(t){t.sprite.remove(),t.game.startNewRound()}leaveState(){this.sprite.remove()}resumeState(){this.game.canvas.append(this.sprite)}}class x{static round(t){return{x:Math.floor(t.x/100)*100,y:Math.floor(t.y/100)*100}}static add(t,e){return{x:t.x+e.x,y:t.y+e.y}}static sub(t,e){return{x:t.x-e.x,y:t.y-e.y}}static normalize(t){let e=Math.sqrt(t.x*t.x+t.y*t.y);return e===0?{x:0,y:0}:{x:t.x/e,y:t.y/e}}static mult(t,e){return{x:t.x*e,y:t.y*e}}static toScreenCoords(t){return{x:t.x*100+50,y:t.y*100+100}}}class E{constructor(t,e,r,i,o,a){s(this,"boardController");s(this,"canvas",document.querySelector(".board-wrapper"));s(this,"boardImg",document.querySelector(".board-img"));s(this,"state");s(this,"board",[]);s(this,"INITIALTURN");s(this,"turn");s(this,"timerController");s(this,"TIMERDURATION");s(this,"redScore",0);s(this,"yellowScore",0);s(this,"redScoreboard",document.querySelector(".player-score.red-player"));s(this,"yellowScoreboard",document.querySelector(".player-score.yellow-player"));s(this,"ROUNDSEACHGAME");s(this,"ALLOWREDOUNDO");s(this,"INFIN");s(this,"gameSaves",[]);s(this,"pointer",0);s(this,"paused",!1);var l,c;this.INITIALTURN=e,this.turn=e,this.boardController=t,this.TIMERDURATION=r,this.INFIN=i,i?this.timerController=new g(this,-1):this.timerController=new g(this,this.TIMERDURATION),this.redScoreboard.innerText="0",this.yellowScoreboard.innerText="0",this.ROUNDSEACHGAME=o,this.ALLOWREDOUNDO=a,a?(l=this.boardController.undoController)==null||l.show():(c=this.boardController.undoController)==null||c.hide(),this.changeState(new m(this)),this.resetBoard()}incrementRedScore(){this.redScore++,this.redScoreboard.innerText=`${this.redScore}`}incrementYellowScore(){this.yellowScore++,this.yellowScoreboard.innerText=`${this.yellowScore}`}decrementScore(t){t=="R"?(this.redScore--,this.redScoreboard.innerText=`${this.redScore}`):(this.yellowScore--,this.yellowScoreboard.innerText=`${this.yellowScore}`)}getScore(t){return t=="R"?this.redScore:this.yellowScore}getMousePos(){return this.boardController.mousePos}startNewRound(){this.turn=this.INITIALTURN,this.resetBoard(),this.pointer=0,this.gameSaves=[],this.gameSaves[this.pointer++]={board:this.copyMatrix(this.board),turn:this.turn},this.changeState(new p(this))}changeState(t){this.state&&this.state.leaveState(),this.state=t}removeHTMLTokens(){document.querySelectorAll(".board-token").forEach(e=>e.remove())}resetBoard(){this.board=[];for(let t=0;t<h;t++){let e=[];this.board.push(e);for(let r=0;r<u;r++)this.board[t][r]="-"}this.removeHTMLTokens(),this.timerController.setTurn(this.turn)}copyMatrix(t){return t.map(e=>e.slice())}otherTurn(t){return t=="R"?"Y":"R"}placeToken(t,e=-1){let r;e<0?r=this.calculateDestRow(t):r=e,this.board[r][t]=this.turn}updateBoardHTML(){this.removeHTMLTokens();for(let t=0;t<h;t++)for(let e=0;e<u;e++)if(this.board[t][e]!="-"){let r=new y(x.toScreenCoords({x:e,y:t}),this.board[t][e]);this.canvas.append(r.sprite)}}undo(){this.pointer<=1||(this.state instanceof d?(this.decrementScore(this.turn),this.pointer-=2):this.pointer-=1,this.board=this.copyMatrix(this.gameSaves[this.pointer-1].board),this.turn=this.gameSaves[this.pointer-1].turn,this.timerController.setTurn(this.turn),this.timerController.startTimer(),this.updateBoardHTML(),this.changeState(new p(this)))}redo(){if(this.pointer>=this.gameSaves.length)return;this.pointer+=1,this.board=this.copyMatrix(this.gameSaves[this.pointer-1].board),this.turn=this.gameSaves[this.pointer-1].turn,this.timerController.setTurn(this.turn),this.timerController.startTimer(),this.updateBoardHTML();let t=this.checkWin();t=="T"?this.changeState(new d(this,this.turn,this.timerController)):t=="N"&&this.changeState(new d(this,"N",this.timerController))}switchTurns(){this.turn=="R"?this.turn="Y":this.turn=="Y"&&(this.turn="R"),this.timerController.setTurn(this.turn),this.timerController.startTimer()}calculateDestRow(t){let e=t;for(let r=h-1;r>=0;r--)if(this.board[r][e]=="-")return r;return-1}checkHorizontal(t){for(let e=0;e<h;e++)for(let r=0;r<=u-4;r++){let i=!0;for(let o=0;o<4;o++)this.board[e][r+o]!=t&&(i=!1);if(i)return!0}return!1}checkVertical(t){for(let e=0;e<=h-4;e++)for(let r=0;r<u;r++){let i=!0;for(let o=0;o<4;o++)this.board[e+o][r]!=t&&(i=!1);if(i)return!0}return!1}checkDiagonal(t){for(let e=0;e<=h-4;e++)for(let r=0;r<=u-4;r++){let i=!0;for(let o=0;o<4;o++)this.board[e+o][r+o]!=t&&(i=!1);if(i)return!0}return!1}checkOffDiagonal(t){for(let e=h-3;e<h;e++)for(let r=0;r<=u-4;r++){let i=!0;for(let o=0;o<4;o++)this.board[e-o][r+o]!=t&&(i=!1);if(i)return!0}return!1}checkTie(){for(let t=0;t<h;t++)for(let e=0;e<u;e++)if(this.board[t][e]=="-")return!1;return!0}reactToWin(){let t=this.checkWin();t=="T"?this.changeState(new d(this,this.turn,this.timerController)):t=="N"?this.changeState(new d(this,"N",this.timerController)):t=="F"&&(this.switchTurns(),this.changeState(new p(this)));let e={board:this.copyMatrix(this.board),turn:this.turn};this.gameSaves[this.pointer++]=e,this.gameSaves=this.gameSaves.slice(0,this.pointer)}checkWin(){return this.checkHorizontal(this.turn)||this.checkVertical(this.turn)||this.checkDiagonal(this.turn)||this.checkOffDiagonal(this.turn)?"T":this.checkTie()?"N":"F"}pause(){var t;this.paused=!0,(t=this.state)==null||t.leaveState(),this.timerController.pauseTimer()}resume(){var t;this.paused=!1,(t=this.state)==null||t.resumeState()}}class C{constructor(){s(this,"eventListeners",[{type:"mousemove",listener:t=>this.updateMousePos(t,this)}]);s(this,"currentGame");s(this,"mousePos");s(this,"sprite",document.querySelector(".board-wrapper"));s(this,"boardImg",document.querySelector(".board-img"));s(this,"nextGameData",{timerDuration:30,infin:!1,roundsEachGame:3,allowUndoRedo:!1});s(this,"undoController",null);this.addEventListeners(),this.mousePos={x:50,y:0},this.currentGame=null,this.startNewGame()}addUndoController(t){this.undoController=t}startNewGame(){var t;(t=this.currentGame)==null||t.pause(),this.currentGame=new E(this,"R",this.nextGameData.timerDuration,this.nextGameData.infin,this.nextGameData.roundsEachGame,this.nextGameData.allowUndoRedo)}addEventListeners(){this.eventListeners.forEach(t=>{this.boardImg.addEventListener(t.type,t.listener)})}removeEventListeners(){this.eventListeners.forEach(t=>{this.boardImg.removeEventListener(t.type,t.listener)})}updateMousePos(t,e){t.offsetY>650||(e.mousePos={x:t.offsetX,y:t.offsetY})}}class k{constructor(t){s(this,"leftButton",document.querySelector(".undo-redo-button.left"));s(this,"rightButton",document.querySelector(".undo-redo-button.right"));s(this,"boardController");this.boardController=t,this.leftButton.addEventListener("mousedown",()=>{this.buttonDown(this.leftButton)}),this.leftButton.addEventListener("mouseup",()=>{this.buttonUp(this.leftButton)}),this.leftButton.addEventListener("mouseleave",()=>{this.buttonUp(this.leftButton)}),this.leftButton.addEventListener("click",()=>this.undo()),this.rightButton.addEventListener("mousedown",()=>{this.buttonDown(this.rightButton)}),this.rightButton.addEventListener("mouseup",()=>{this.buttonUp(this.rightButton)}),this.rightButton.addEventListener("mouseleave",()=>{this.buttonUp(this.rightButton)}),this.rightButton.addEventListener("click",()=>this.redo())}hide(){this.leftButton.style.display="none",this.rightButton.style.display="none"}show(){this.leftButton.style.display="flex",this.rightButton.style.display="flex"}undo(){var t,e,r;((t=this.boardController.currentGame)==null?void 0:t.state)instanceof m||(e=this.boardController.currentGame)!=null&&e.paused||(r=this.boardController.currentGame)==null||r.undo()}redo(){var t,e,r;((t=this.boardController.currentGame)==null?void 0:t.state)instanceof m||(e=this.boardController.currentGame)!=null&&e.paused||(r=this.boardController.currentGame)==null||r.redo()}buttonDown(t){t.classList.toggle("clicked",!0)}buttonUp(t){t.classList.toggle("clicked",!1)}}class R{constructor(t){s(this,"sprite",document.querySelector(".button-purple.restart"));s(this,"boardController");s(this,"showing",!1);this.boardController=t,this.sprite.addEventListener("click",()=>this.showScreen(this))}showScreen(t){var r;if(this.showing)return;(r=t.boardController.currentGame)==null||r.pause(),this.showing=!0;let e=new M(t.boardController,t);t.boardController.sprite.append(e.sprite)}}class M{constructor(t,e){s(this,"sprite");s(this,"yesButton");s(this,"noButton");s(this,"boardController");this.boardController=t,this.sprite=document.createElement("div"),this.sprite.classList.add("board-alert","restart"),this.sprite.innerHTML='<div class="text-box"><div class="block1">Game still ongoing. All scores will be lost. <br>Are you sure you want to restart?</div><div><button class="button-purple yes">YES</button><button class="button-purple no">NO</button></div></div>',this.yesButton=this.sprite.querySelector(".button-purple.yes"),this.yesButton.addEventListener("click",r=>{e.showing=!1,r.stopPropagation(),this.yes(this)}),this.noButton=this.sprite.querySelector(".button-purple.no"),this.noButton.addEventListener("click",r=>{e.showing=!1,r.stopPropagation(),this.no(this)}),this.sprite.style.display="flex"}yes(t){t.sprite.remove(),t.boardController.startNewGame()}no(t){var e;console.log("here"),t.sprite.remove(),(e=t.boardController.currentGame)==null||e.resume()}}class N{constructor(t){s(this,"button",document.querySelector(".button-purple.settings"));s(this,"menu",document.querySelector(".menu"));s(this,"upArrow",this.menu.querySelector(".up-arrow"));s(this,"applyButton",this.menu.querySelector(".button-purple.apply"));s(this,"message",this.menu.querySelector(".message"));s(this,"boardController");s(this,"infinCheckbox",this.menu.querySelector(".infin"));s(this,"timer",this.menu.querySelector(".timer-duration"));s(this,"showing",!1);this.boardController=t,this.button.addEventListener("click",()=>this.showMenu(this)),this.upArrow.addEventListener("click",()=>this.hideMenu(this)),this.applyButton.addEventListener("click",()=>this.giveData(this)),this.infinCheckbox.addEventListener("change",()=>{this.infinCheckbox.checked?this.timer.disabled=!0:this.timer.disabled=!1})}showMenu(t){t.showing||(t.showing=!0,t.menu.style.display="block",setTimeout(()=>t.menu.classList.toggle("show",!0),1e-4))}hideMenu(t){t.menu.classList.toggle("show",!1),t.menu.addEventListener("transitionend",()=>{t.menu.style.display="none"},{once:!0}),t.showing=!1}validateData(t,e,r){return t<=0&&!e?{success:!1,message:"Timer duration must be a positive integer"}:r<=0||r%2!=1?{success:!1,message:'"Best of" must be a positive odd integer'}:{success:!0,message:"Changes will apply next game"}}giveData(t){let e=t.timer.value==""?-1:Number(t.timer.value),r=t.infinCheckbox.checked,i=this.menu.querySelector(".rounds-each-game").value,o=i==""?-1:Number(i),a=this.menu.querySelector(".allow").checked;t.message.innerHTML="";let{success:l,message:c}=this.validateData(e,r,o);l?t.message.innerHTML+='<img src="./src/img/check-circle.svg" width="30" class="icon">':t.message.innerHTML+='<img src="./src/img/cross-circle.svg" width="30" class="icon">',t.message.innerHTML+=c,t.message.classList.toggle("show",!0);let v={timerDuration:e,infin:r,roundsEachGame:o,allowUndoRedo:a};setTimeout(()=>this.doGiveData(this,v,l),1e3)}doGiveData(t,e,r){var i;t.message.classList.toggle("show",!1),r&&(t.message.addEventListener("transitionend",()=>this.hideMenu(t),{once:!0}),t.boardController.nextGameData=e,((i=this.boardController.currentGame)==null?void 0:i.state)instanceof m&&this.boardController.startNewGame())}}let f=new C;new R(f);new N(f);let I=new k(f);f.addUndoController(I);
